<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home | Practice Vault</title>
  <link rel="icon" href="/assets/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/typography.css">
  <link rel="stylesheet" href="/css/core.css">
  
  <script src="/firebase/firebase-app-compat.js"></script>
  <script src="/firebase/firebase-auth-compat.js"></script>
  <script src="/firebase/firebase-firestore-compat.js"></script>
  <script src="/firebase/firebase-init.js"></script>
  
  <script>document.documentElement.dataset.protected = 'true';</script>
  <script src="/config/auth-guard.js"></script>
  
  <script src="/config/components.js"></script>
  <script src="/config/navigation.js"></script>
  <script src="/config/course-data.js"></script>
  
  <style>
    .pathway-section {
      margin-bottom: 56px;
    }
    
    .pathway-banner {
      position: relative;
      height: 140px;
      border-radius: 12px 12px 0 0;
      overflow: hidden;
      background-color: #1a1a2e;
      background-size: cover;
      background-position: center;
      box-shadow: var(--shadow);
    }

    .pathway-banner::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image: inherit;
      background-size: cover;
      background-position: center;
      opacity: 0.15;
    }

    .pathway-banner::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(26,26,46,0.5) 0%, rgba(26,26,46,0.85) 70%, rgba(26,26,46,1) 100%);
    }
    
    .pathway-banner > div {
      position: relative;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 0 24px;
      z-index: 1;
    }

    .pathway-banner h2 {
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      margin: 0;
      text-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    
    .pathway-content {
      background: #fff;
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 12px 12px;
      padding: 24px;
      box-shadow: var(--shadow);
    }
    
    .pathway-topics {
      margin-bottom: 0 !important;
      grid-template-columns: repeat(3, 1fr) !important;
      gap: 16px !important;
      display: grid !important;
    }
    
    @media (max-width: 900px) {
      .pathway-topics {
        grid-template-columns: repeat(2, 1fr) !important;
      }
    }
    
    @media (max-width: 600px) {
      .pathway-topics {
        grid-template-columns: 1fr !important;
      }
    }
    
    .topic-card {
      flex-direction: row;
      align-items: center;
      gap: 16px;
    }
    
    .topic-info {
      flex: 1;
      min-width: 0;
    }
    
    .topic-card .topic-name {
      min-height: auto;
      font-size: var(--text-ui);
      margin-bottom: 6px;
    }
    
    .topic-card .topic-meta {
      margin-top: 0;
      justify-content: flex-start;
      gap: 12px;
    }
    
    .progress-circle {
      width: 44px;
      height: 44px;
      flex-shrink: 0;
    }
    
    .progress-empty {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 4px solid var(--border);
      flex-shrink: 0;
    }
    
    .coming-soon {
      margin: 20px -24px -24px -24px;
      padding: 16px 24px 24px 24px;
      border-top: 2px solid var(--border);
      background: linear-gradient(to bottom, #fafbfc, #fff);
      border-radius: 0 0 8px 8px;
    }
    
    .coming-soon-toggle {
      width: 100%;
      padding: 8px 0;
      background: transparent;
      border: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-size: var(--text-small);
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .coming-soon-toggle:hover {
      color: var(--text-primary);
    }
    
    .coming-soon-label {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .coming-soon-arrow {
      transition: transform 0.3s;
    }
    
    .coming-soon-arrow.expanded {
      transform: rotate(180deg);
    }
    
    .coming-soon-list {
      display: none;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 10px;
      margin-top: 12px;
    }
    
    .coming-soon-list.expanded {
      display: grid;
    }
    
    .coming-soon-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: var(--bg);
      border-radius: 6px;
      font-size: var(--text-small);
      color: var(--text-secondary);
      border: 1px dashed var(--border);
    }
    
    .coming-soon-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      opacity: 0.5;
      flex-shrink: 0;
    }
   
    @media (max-width: 768px) {
      .pathway-banner > div {
        padding: 0 20px;
      }
      
      .pathway-banner h2 {
        font-size: 20px;
      }
    }
  </style>
  
</head>
<body>
  <div id="page-loader" class="page-loader">
    <div class="loading-spinner"></div>
  </div>
  
  <div class="hero">
    <div class="hero-banner" data-bg="home"></div>
    <div class="hero-content">
      <h1 class="hero-title">Practice Vault</h1>
      <div class="hero-badge">Course Library</div>
    </div>
  </div>
  
  <div class="container" id="pathways-container"></div>
  
  <script>
  (function(){
    'use strict';
    
    function waitForData(callback) {
      if (window.VAULT_COURSES) {
        callback();
      } else {
        setTimeout(function() { waitForData(callback); }, 50);
      }
    }
    
    function createProgressCircle(percent) {
      var size = 44;
      var radius = 19;
      var circumference = 2 * Math.PI * radius;
      var offset = circumference - (percent / 100) * circumference;
      var color = percent === 100 ? '#10b981' : '#06b3fd';
      
      var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('class', 'progress-circle');
      svg.setAttribute('width', size);
      svg.setAttribute('height', size);
      svg.style.transform = 'rotate(-90deg)';
      
      var bg = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      bg.setAttribute('cx', 22);
      bg.setAttribute('cy', 22);
      bg.setAttribute('r', radius);
      bg.setAttribute('fill', 'none');
      bg.setAttribute('stroke', '#e9ecef');
      bg.setAttribute('stroke-width', '4');
      
      var progress = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      progress.setAttribute('cx', 22);
      progress.setAttribute('cy', 22);
      progress.setAttribute('r', radius);
      progress.setAttribute('fill', 'none');
      progress.setAttribute('stroke', color);
      progress.setAttribute('stroke-width', '4');
      progress.setAttribute('stroke-dasharray', circumference);
      progress.setAttribute('stroke-dashoffset', offset);
      progress.setAttribute('stroke-linecap', 'round');
      
      var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      text.setAttribute('x', '50%');
      text.setAttribute('y', '50%');
      text.setAttribute('text-anchor', 'middle');
      text.setAttribute('dy', '.35em');
      text.setAttribute('font-size', '11');
      text.setAttribute('font-weight', '700');
      text.setAttribute('fill', '#1a1a1a');
      text.style.transform = 'rotate(90deg)';
      text.style.transformOrigin = 'center';
      text.textContent = percent + '%';
      
      svg.appendChild(bg);
      svg.appendChild(progress);
      svg.appendChild(text);
      return svg;
    }
    
    waitForData(function() {
      var pathways = [
        { id: 'gs', name: 'Groove Studies', image: '/assets/groove-studies.webp' },
        { id: 'fs', name: 'Fill Studies', image: '/assets/fill-studies.webp' },
        { id: 'ss', name: 'Stick Studies', image: '/assets/stick-studies.webp' },
        { id: 'ks', name: 'Kick Studies', image: '/assets/kick-studies.webp' },
        { id: 'rs', name: 'Rhythm Studies', image: '/assets/reading.webp' }
      ];
      
      var container = document.getElementById('pathways-container');
      
      pathways.forEach(function(pathway) {
        var active = [];
        var comingSoon = [];
        
        for (var courseId in window.VAULT_COURSES) {
          var course = window.VAULT_COURSES[courseId];
          if (course.pathway !== pathway.id) continue;
          
          if (course.lessons && course.lessons.length > 0) {
            active.push({ courseId: courseId, course: course });
          } else {
            comingSoon.push({ courseId: courseId, course: course });
          }
        }
        
        if (active.length === 0 && comingSoon.length === 0) return;
        
        var section = document.createElement('div');
        section.className = 'pathway-section';
        
        // Banner
        var banner = document.createElement('div');
        banner.className = 'pathway-banner';
        banner.style.backgroundImage = 'url(' + pathway.image + ')';
        
        var titleContainer = document.createElement('div');
        var title = document.createElement('h2');
        title.textContent = pathway.name;
        titleContainer.appendChild(title);
        
        var desc = document.createElement('p');
        desc.style.cssText = 'color: rgba(255,255,255,0.8); font-size: 14px; margin: 4px 0 0 0; font-weight: 400;';
        var descriptions = {
          'gs': 'Explore essential groove concepts',
          'fs': 'Build your fills and transitions',
          'ss': 'Develop hand speed and control',
          'ks': 'Strengthen foot power and coordination',
          'rs': 'Improve reading and notation skills'
        };
        desc.textContent = descriptions[pathway.id] || '';
        titleContainer.appendChild(desc);
        
        banner.appendChild(titleContainer);
        section.appendChild(banner);
        
        // Content
        var content = document.createElement('div');
        content.className = 'pathway-content';
        
        if (active.length > 0) {
          var grid = document.createElement('div');
          grid.className = 'pathway-topics';
          
          active.forEach(function(item) {
            var card = document.createElement('a');
            card.className = 'topic-card';
            card.href = '/' + pathway.id + '?' + item.course.slug;
            
            var info = document.createElement('div');
            info.className = 'topic-info';
            
            var name = document.createElement('div');
            name.className = 'topic-name';
            name.textContent = item.course.topic;
            info.appendChild(name);
            
            var meta = document.createElement('div');
            meta.className = 'topic-meta';
            
            var lessons = document.createElement('span');
            lessons.className = 'topic-lessons';
            lessons.textContent = item.course.lessons.length + ' Lesson' + (item.course.lessons.length === 1 ? '' : 's');
            meta.appendChild(lessons);
            
            if (item.course.levels && item.course.levels.length > 0) {
              var badges = document.createElement('div');
              badges.className = 'level-badges';
              item.course.levels.forEach(function(level) {
                var badge = document.createElement('span');
                badge.className = 'level-badge ' + level.toLowerCase();
                badge.textContent = level.toUpperCase();
                badges.appendChild(badge);
              });
              meta.appendChild(badges);
            }
            
            info.appendChild(meta);
            card.appendChild(info);
            
            var progressDiv = document.createElement('div');
            progressDiv.className = 'progress-empty';
            progressDiv.id = item.courseId + '-progress-circle';
            card.appendChild(progressDiv);
            
            grid.appendChild(card);
          });
          
          content.appendChild(grid);
        }
        
        // Coming soon
        if (comingSoon.length > 0) {
          var csSection = document.createElement('div');
          csSection.className = 'coming-soon';
          
          var toggle = document.createElement('button');
          toggle.className = 'coming-soon-toggle';
          
          var label = document.createElement('div');
          label.className = 'coming-soon-label';
          label.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" opacity="0.4"/><path d="M12 6v6l4 2" opacity="0.4"/></svg>';
          label.appendChild(document.createTextNode('Coming Soon'));
          
          var arrow = document.createElement('div');
          arrow.className = 'coming-soon-arrow';
          arrow.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>';
          
          toggle.appendChild(label);
          toggle.appendChild(arrow);
          
          var list = document.createElement('div');
          list.className = 'coming-soon-list';
          
          comingSoon.forEach(function(item) {
            var csItem = document.createElement('div');
            csItem.className = 'coming-soon-item';
            var dot = document.createElement('div');
            dot.className = 'coming-soon-dot';
            csItem.appendChild(dot);
            csItem.appendChild(document.createTextNode(item.course.topic));
            list.appendChild(csItem);
          });
          
          toggle.addEventListener('click', function() {
            list.classList.toggle('expanded');
            arrow.classList.toggle('expanded');
          });
          
          csSection.appendChild(toggle);
          csSection.appendChild(list);
          content.appendChild(csSection);
        }
        
        section.appendChild(content);
        container.appendChild(section);
      });
      
      loadProgress();
    });
    
    function loadProgress() {
      if (typeof firebase === 'undefined' || !firebase.auth) {
        setTimeout(loadProgress, 100);
        return;
      }
      
      firebase.auth().onAuthStateChanged(function(user) {
        if (!user) return;
        
        var db = firebase.firestore();
        
        for (var courseId in window.VAULT_COURSES) {
          var el = document.getElementById(courseId + '-progress-circle');
          if (!el) continue;
          
          var config = window.VAULT_COURSES[courseId];
          if (!config.lessons || config.lessons.length === 0) continue;
          
          (function(cId, elem, cfg) {
            db.collection('users').doc(user.uid).collection('progress').doc(cId)
              .get()
              .then(function(snap) {
                var total = cfg.lessons.length;
                var count = 0;
                
                if (snap.exists) {
                  var completed = snap.data().completed || [];
                  if (typeof window.normalizeCompleted === 'function') {
                    completed = window.normalizeCompleted(completed);
                  }
                  cfg.lessons.forEach(function(lessonId) {
                    if (completed.indexOf(lessonId) !== -1) count++;
                  });
                }
                
                var percent = total > 0 ? Math.round((count / total) * 100) : 0;
                if (percent > 0) {
                  elem.parentNode.replaceChild(createProgressCircle(percent), elem);
                }
              });
          })(courseId, el, config);
        }
      });
    }
  })();
  </script>

</body>
</html>
